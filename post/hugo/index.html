<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.80.0" />

  <title>那些Hugo踩过的坑 &middot; Air Junda Space</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://airjunda.github.io/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://airjunda.github.io/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://airjunda.github.io/css/blackburn.css">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Raleway&display=swap" rel="stylesheet" type="text/css">

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/androidstudio.min.css">
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/highlight.min.js"></script>
  
  <script async src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/languages/yaml.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://airjunda.github.io/img/favicon.ico" type="image/x-icon" />

  
    
        <link rel="stylesheet" href="https://airjunda.github.io/css/my.css">
    
  
  
    
        <script src="https://airjunda.github.io/js/my.js"></script>
    
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://airjunda.github.io/">Air Junda</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://airjunda.github.io/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://airjunda.github.io/post/"><i class='fa fa-list fa-fw'></i>Articles</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://airjunda.github.io/about/"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://airjunda.github.io/contact/"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/*" rel="me" target="_blank"><i class="fab fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/*" rel="me" target="_blank"><i class="fab fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="http://weibo.com/*" rel="me" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://instagram.com/*" rel="me" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
    </li>
    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://youtube.com/user/*" rel="me" target="_blank"><i class="fab fa-youtube-square fa-fw"></i>YouTube</a>
    </li>
    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/jundali" rel="me" target="_blank"><i class="fab fa-linkedin fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/airjunda" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://gitlab.com/*" rel="me" target="_blank"><i class="fab fa-gitlab fa-fw"></i>GitLab</a>
    </li>
    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://steamcommunity.com/id/*" rel="me" target="_blank"><i class="fab fa-steam-square fa-fw"></i>Steam</a>
    </li>
    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2021. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>那些Hugo踩过的坑</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>04 Nov 2021, 22:39</time>
  </div>

  

  

  

</div>

  <h2 id="preface">Preface</h2>
<p>部署网站这事就是个ops的活。虽然我工作的部门也是做ops的，但是我其实是不太喜欢做ops。无论是编程还是以前做实验，做ops经常会手忙脚乱。那怕按照给的文章或者guide去做，我依然会遇到一些奇奇怪怪的hurdles。这篇文章就是记录下我第一次上线这个网站时踩过的坑。</p>
<h2 id="那些年踩过的坑">那些年踩过的坑</h2>
<p>人类的本质是复读机。万事开头，先搜攻略。于是搜到了这2个，觉得比较有用。未来如果忘了hugo部署也可以直接从这2个攻略复习。</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/57361697">https://zhuanlan.zhihu.com/p/57361697</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/105021100?utm_source=wechat_timeline&amp;utm_medium=social&amp;utm_oi=545850779622232064&amp;utm_content=first">https://zhuanlan.zhihu.com/p/105021100?utm_source=wechat_timeline&amp;utm_medium=social&amp;utm_oi=545850779622232064&amp;utm_content=first</a></li>
</ul>
<p>下面开始说按照上面的步骤时遇到的坑和注意事项。</p>
<h3 id="发布前的阶段">发布前的阶段</h3>
<p>安装好hugo后，主要做的事情是导入自己喜欢的theme，和用MD写自己的文章，然后在本地跑起来，预览下网站效果。</p>
<ul>
<li>导入theme
<ul>
<li>导入theme时，不同攻略中有2种方式：使用git submodule命令或者直接git clone。 建议使用 <code>git submodule add</code> 去导入。原因是如果使用action的CICD, 现有的yaml文件里需要指定theme文件是通过submodule去拉取。如果一开始没有添加theme路径为submodule, 在workflow的build阶段会报错找不到submodule theme/xxx。使用submodule的例子如下：</li>
</ul>
<blockquote>
<p><code>git submodule add https://github.com/dillonzq/LoveIt.git themes/LoveIt</code></p>
</blockquote>
</li>
<li>创建新文章
<ul>
<li>命令是这样写的 <code>hugo new posts/demo.md </code> 但是很多theme默认文章是在 post/ 目录下。因此如果发现自己写的文章在网站启动后找不到，建议把上面命令里的posts改成post试一试。这个坑我搞了半个晚上才发现 XD</li>
</ul>
</li>
</ul>
<h3 id="发布阶段">发布阶段</h3>
<p>文章写好，本地调试后就要部署了。我们本地写的md文章其实是需要生成html,css,js等网页的文件然后才能发布成一个网站。不过这个任务就是Hugo去做了。Hugo解放了我们，让我们可以专心写md而不用管html这些细节。</p>
<p>生成网站文件的命令是 <code>hugo -D</code> 默认是在当前根目录下生成一个public文件夹。这个public里的内容才是部署需要的。到这一步时，项目文件的结构应该是这样的：</p>
<pre><code>├── archetypes # 存放生成博客的模版
├── assets # 存放被 Hugo Pipes 处理的文件
├── config.toml # hugo 配置文件 
├── content # 存放 markdown 文件
├── data # 存放 Hugo 处理的数据
├── layouts # 存放布局文件
├── static # 存放静态文件 图片 CSS JS文件
├── themes # 存放主题
└── public # 存放生成的网页文件
</code></pre><p>这个根目录只是我们的workspace，我们要的结果其实是public文件夹(当然也可自定义输出文件夹名字)。有了这些后，就可以用github page去部署了。github page其实就是能将包含网页文件的repo给生成一个静态网站让他人访问。这样的repo通常会一个index.html文件作为站点索引。这个在public里能找到。</p>
<p>如果我们要使用github page去部署，根据github要求，这个网站的repo需要命名为 <code>username.github.io</code>。那么问题来了：这个repo里放的是整个workspace还是只是public这个文件夹呢？</p>
<p>其实都可以。不同攻略里处理方式都不一样。有人把网站文件生成到/docs路径下。然后把整个workspace推上去，然后在github page的设置里指定/docs。这样同样能部署。但是有人提醒这样不安全。因为你的workspace别人也能看到。更好的方式是建2个repo。一个是workspace的repo。另一个是public文件的repo并且github.io结尾的repo是指向的后者。</p>
<p>上面我给的第一个link里就是这么处理的。然后还有个事要做，就是在workspace的repo 里把public folder设置为submodule：<br>
<code>git submodule add -b main https://url-to-github.io.git public</code><br>
这么做据说是可以</p>
<blockquote>
<p>“当你 push worksapce库时，工作流自动将worksapce库的编译输出(/docs目录中的变更信息)合并io仓库，这样你就能隔离两个工作环境，还能随时存储你的工作进度”</p>
</blockquote>
<p>我上面那句其实没完全懂，但是如果不设置submodule, 推送workspace会提示warning nested git repo，要求你设置成submodule。 所以最佳实践还是做一下吧。不要跳！看完这些，如果一些细节还是不太懂做了啥，可以看下面这个youtube demo:
<a href="https://www.youtube.com/watch?v=LIFvgrRxdt4">Creating a Blog with Hugo and Github in 10 minutes</a></p>
<h3 id="发布后阶段">发布后阶段</h3>
<p>这个阶段我只遇到一个坑</p>
<ul>
<li>如果public的repo里有readme, 会和index.html冲突。导致page显示的是readme而非index.html。Solution:
<ul>
<li>在readme段首插入这三行<!-- raw HTML omitted -->
&mdash;<!-- raw HTML omitted -->
permalink: /index.html<!-- raw HTML omitted -->
&mdash;<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>
<p>到这一步，我踩过的坑都讲完了。最后放几个我当时看过的别人写的Hugo文章。</p>
<h2 id="reading-list">Reading List</h2>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1769218">https://cloud.tencent.com/developer/article/1769218</a> (架构图不错)</li>
</ul>

  
  <h4><i class="fas fa-share-alt" aria-hidden="true"></i>&nbsp;Share!</h4>
<ul class="share-buttons">
	<li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Share on Facebook"><i class="fab fa-facebook" aria-hidden="true"></i><span class="sr-only">Share on Facebook</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://twitter.com/intent/tweet?source=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Tweet"><i class="fab fa-twitter" aria-hidden="true"></i><span class="sr-only">Tweet</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="https://plus.google.com/share?url=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Share on Google+"><i class="fab fa-google-plus" aria-hidden="true"></i><span class="sr-only">Share on Google+</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.tumblr.com/share?v=3&u=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Post to Tumblr"><i class="fab fa-tumblr" aria-hidden="true"></i><span class="sr-only">Post to Tumblr</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Pin it"><i class="fab fa-pinterest-p" aria-hidden="true"></i><span class="sr-only">Pin it</span></a>
	</li>&nbsp;&nbsp;&nbsp;
	<li><a href="http://www.reddit.com/submit?url=https%3a%2f%2fairjunda.github.io%2fpost%2fhugo%2f" target="_blank" title="Submit to Reddit"><i class="fab fa-reddit-alien" aria-hidden="true"></i><span class="sr-only">Submit to Reddit</span></a>
	</li>
</ul>


<style>
	ul.share-buttons{
	  list-style: none;
	  padding: 0;
	}

	ul.share-buttons li{
	  display: inline;
	}

	ul.share-buttons .sr-only{
	  position: absolute;
	  clip: rect(1px 1px 1px 1px);
	  clip: rect(1px, 1px, 1px, 1px);
	  padding: 0;
	  border: 0;
	  height: 1px;
	  width: 1px;
	  overflow: hidden;
	}
</style>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://airjunda.github.io/post/my-first-post/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://airjunda.github.io/post/my-first-post/">My First Post</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
  </div>
</div>


  
  
  
  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'AirJunda';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


  

</div>

</div>
</div>
<script src="https://airjunda.github.io/js/ui.js"></script>
<script src="https://airjunda.github.io/js/menus.js"></script>






<script async src="https://www.googletagmanager.com/gtag/js?id=Your%20Google%20Analytics%20tracking%20ID"></script>
<script>
  
  if (window.location.hostname != "localhost") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'Your Google Analytics tracking ID');
  }
</script>





<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="\/\/analytics.example.com\/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId',  2 ]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//analytics.example.com/piwik.php?idsite=2" style="border:0;" alt="" /></p></noscript>





</body>
</html>

